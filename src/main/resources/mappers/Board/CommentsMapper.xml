<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Comments">
    <insert id="commentsIn" parameterType="cdto">
        INSERT INTO COMMENTS (
            COMMENTSID, BOARDID, BOARDTYPE, COMMENTSCONTENT,
            COMMENTSNAME, COMMENTSDATE, COMMENTSNO, MEMNO,
            PARENTBOARDNO, PARENTBOARDID
        ) VALUES (
                     SEQ_COMMENTS.NEXTVAL, #{boardId}, #{boardType}, #{commentsContent},
                     #{commentsName}, SYSDATE, #{commentsNo}, #{memNo},
                     #{parentBoardNo, jdbcType=INTEGER}, #{parentBoardId, jdbcType=INTEGER}
                 )
    </insert>

    <select id="commentsList" parameterType="int" resultType="cdto">
        SELECT *
        FROM COMMENTS
        WHERE BOARDID = #{boardId}
            START WITH PARENTBOARDID IS NULL
            CONNECT BY PRIOR COMMENTSID = PARENTBOARDID
        ORDER SIBLINGS BY COMMENTSID ASC
    </select>
    <!-- 댓글 수정 -->
    <update id="commentsUpdate" parameterType="cdto">
        UPDATE COMMENTS SET COMMENTSCONTENT = #{commentsContent}
        WHERE COMMENTSID = #{commentsId} AND MEMNO = #{memNo}
    </update>

    <!-- 댓글 삭제 -->
    <delete id="commentsDelete" parameterType="map">
        DELETE FROM COMMENTS
        WHERE (COMMENTSID = #{commentsId} OR PARENTBOARDID = #{commentsId})
          AND (MEMNO = #{memNo} OR EXISTS (
            SELECT 1 FROM COMMENTS
            WHERE COMMENTSID = #{commentsId} AND MEMNO = #{memNo}
        ))
    </delete>


</mapper>